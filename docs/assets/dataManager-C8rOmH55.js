const _={auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0,storageKey:"supabase.auth.token",autoRefreshTokenRetryAttempts:5,tokenRefreshMargin:60},global:{headers:{"X-Client-Info":"fifa-tracker/1.0.0","X-Client-Version":"2.0.0"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}},P=()=>{let m=null,e=[],s=new Map,n="excellent";const t={players:[{id:1,name:"Max M√ºller",team:"AEK",position:"ST",value:12e4,goals:3,created_at:"2024-01-01"},{id:2,name:"Tom Schmidt",team:"AEK",position:"TH",value:1e5,goals:1,created_at:"2024-01-02"},{id:3,name:"Leon Wagner",team:"AEK",position:"IV",value:9e4,goals:1,created_at:"2024-01-03"},{id:4,name:"Tim Fischer",team:"AEK",position:"ZM",value:85e3,goals:1,created_at:"2024-01-04"},{id:5,name:"Jan Becker",team:"Real",position:"ST",value:11e4,goals:4,created_at:"2024-01-05"},{id:6,name:"Paul Klein",team:"Real",position:"TH",value:95e3,goals:1,created_at:"2024-01-06"},{id:7,name:"Lukas Wolf",team:"Real",position:"IV",value:88e3,goals:1,created_at:"2024-01-07"},{id:8,name:"Ben Richter",team:"Real",position:"ZM",value:92e3,goals:1,created_at:"2024-01-08"},{id:9,name:"Alex Weber",team:"Ehemalige",position:"ST",value:75e3,goals:2,created_at:"2024-01-09"},{id:10,name:"Chris Meyer",team:"Ehemalige",position:"ZM",value:7e4,goals:0,created_at:"2024-01-10"}],matches:[{id:1,teama:"AEK",teamb:"Real",goalsa:2,goalsb:1,date:"2024-08-12",created_at:"2024-08-12",manofthematch:"Max M√ºller",goalslista:["Max M√ºller","Tom Schmidt"],goalslistb:["Jan Becker"]},{id:2,teama:"AEK",teamb:"Real",goalsa:1,goalsb:3,date:"2024-08-10",created_at:"2024-08-10",manofthematch:"Jan Becker",goalslista:["Leon Wagner"],goalslistb:["Jan Becker","Paul Klein","Lukas Wolf"]},{id:3,teama:"AEK",teamb:"Real",goalsa:0,goalsb:2,date:"2024-08-08",created_at:"2024-08-08",manofthematch:"Ben Richter",goalslista:[],goalslistb:["Jan Becker","Ben Richter"]},{id:4,teama:"AEK",teamb:"Real",goalsa:2,goalsb:2,date:"2024-08-05",created_at:"2024-08-05",manofthematch:"Max M√ºller",goalslista:["Max M√ºller","Tim Fischer"],goalslistb:["Jan Becker","Paul Klein"]}],bans:[{id:1,player_id:1,matches_remaining:2,reason:"Gelb-Rot Karte",created_at:"2024-08-01"},{id:2,player_id:5,matches_remaining:1,reason:"Unsportlichkeit",created_at:"2024-08-05"}],transactions:[{id:1,amount:-5e4,info:"Spielerkauf: Max M√ºller",team:"AEK",date:"2024-08-10",type:"Spielerkauf",match_id:null},{id:2,amount:3e4,info:"Spielerverkauf: Klaus Meyer",team:"AEK",date:"2024-08-11",type:"Spielerverkauf",match_id:null},{id:3,amount:-45e3,info:"Spielerkauf: Jan Becker",team:"Real",date:"2024-08-10",type:"Spielerkauf",match_id:null},{id:4,amount:25e3,info:"Sponsoring Einnahme",team:"Real",date:"2024-08-11",type:"Sonstiges",match_id:null},{id:5,amount:5e3,info:"Match-Sieg Preisgeld",team:"AEK",date:"2024-08-12",type:"Preisgeld",match_id:1},{id:6,amount:3e3,info:"Match-Niederlage Preisgeld",team:"Real",date:"2024-08-12",type:"Preisgeld",match_id:1},{id:7,amount:1500,info:"SdS Bonus: Max M√ºller",team:"AEK",date:"2024-08-12",type:"SdS Bonus",match_id:1},{id:8,amount:2e3,info:"Liga-Bonus",team:"AEK",date:"2024-08-13",type:"Sonstiges",match_id:null},{id:9,amount:-1e3,info:"Kartenstrafe",team:"Real",date:"2024-08-13",type:"Strafe",match_id:null},{id:10,amount:3e3,info:"Match-Niederlage Preisgeld",team:"AEK",date:"2024-08-10",type:"Preisgeld",match_id:2},{id:11,amount:5e3,info:"Match-Sieg Preisgeld",team:"Real",date:"2024-08-10",type:"Preisgeld",match_id:2},{id:12,amount:1500,info:"SdS Bonus: Jan Becker",team:"Real",date:"2024-08-10",type:"SdS Bonus",match_id:2},{id:13,amount:3e3,info:"Match-Niederlage Preisgeld",team:"AEK",date:"2024-08-08",type:"Preisgeld",match_id:3},{id:14,amount:5e3,info:"Match-Sieg Preisgeld",team:"Real",date:"2024-08-08",type:"Preisgeld",match_id:3},{id:15,amount:1500,info:"SdS Bonus: Ben Richter",team:"Real",date:"2024-08-08",type:"SdS Bonus",match_id:3},{id:16,amount:4e3,info:"Unentschieden Preisgeld",team:"AEK",date:"2024-08-05",type:"Preisgeld",match_id:4},{id:17,amount:4e3,info:"Unentschieden Preisgeld",team:"Real",date:"2024-08-05",type:"Preisgeld",match_id:4},{id:18,amount:1500,info:"SdS Bonus: Max M√ºller",team:"AEK",date:"2024-08-05",type:"SdS Bonus",match_id:4}],finances:[{id:1,team:"AEK",balance:15e4,debt:0,created_at:"2024-01-01"},{id:2,team:"Real",balance:175e3,debt:0,created_at:"2024-01-01"}],spieler_des_spiels:[{id:1,name:"Max M√ºller",team:"AEK",count:3,created_at:"2024-08-01"},{id:2,name:"Jan Becker",team:"Real",count:2,created_at:"2024-08-05"},{id:3,name:"Tom Schmidt",team:"AEK",count:2,created_at:"2024-08-08"},{id:4,name:"Paul Klein",team:"Real",count:1,created_at:"2024-08-10"},{id:5,name:"Leon Wagner",team:"AEK",count:1,created_at:"2024-08-12"},{id:6,name:"Lukas Wolf",team:"Real",count:0,created_at:"2024-08-13"},{id:7,name:"Tim Fischer",team:"AEK",count:0,created_at:"2024-08-13"},{id:8,name:"Ben Richter",team:"Real",count:0,created_at:"2024-08-13"}],managers:[{id:1,name:"Alexander",gewicht:110,created_at:"2024-01-01"},{id:2,name:"Philip",gewicht:105,created_at:"2024-01-01"}]},r=(i,o={})=>{let u=[...t[i]||[]];if(o.conditions&&Array.isArray(o.conditions))for(const d of o.conditions){const{type:a,column:c,value:h}=d;switch(a){case"eq":u=u.filter(f=>f[c]===h);break;case"neq":u=u.filter(f=>f[c]!==h);break;case"gt":u=u.filter(f=>f[c]>h);break;case"gte":u=u.filter(f=>f[c]>=h);break;case"lt":u=u.filter(f=>f[c]<h);break;case"lte":u=u.filter(f=>f[c]<=h);break;case"like":const g=new RegExp(h.replace(/%/g,".*"),"i");u=u.filter(f=>g.test(f[c]));break;case"in":u=u.filter(f=>h.includes(f[c]));break}}else{if(o.eq){const[d,a]=o.eq;u=u.filter(c=>c[d]===a)}if(o.neq){const[d,a]=o.neq;u=u.filter(c=>c[d]!==a)}if(o.gt){const[d,a]=o.gt;u=u.filter(c=>c[d]>a)}if(o.gte){const[d,a]=o.gte;u=u.filter(c=>c[d]>=a)}if(o.lt){const[d,a]=o.lt;u=u.filter(c=>c[d]<a)}if(o.lte){const[d,a]=o.lte;u=u.filter(c=>c[d]<=a)}if(o.like){const[d,a]=o.like,c=new RegExp(a.replace(/%/g,".*"),"i");u=u.filter(h=>c.test(h[d]))}if(o.in){const[d,a]=o.in;u=u.filter(c=>a.includes(c[d]))}}if(o.order){const[d,a="asc"]=o.order;u.sort((c,h)=>a==="desc"?h[d]>c[d]?1:-1:c[d]>h[d]?1:-1)}if(o.range){const[d,a]=o.range;u=u.slice(d,a+1)}else o.limit&&(u=u.slice(0,o.limit));return u};return{auth:{getSession:()=>{if(!m)try{const i=localStorage.getItem("supabase.auth.token");if(i){const o=JSON.parse(i);o.expires_at&&o.expires_at>Date.now()/1e3?(m=o,console.log("‚úÖ Restored demo session from localStorage")):(localStorage.removeItem("supabase.auth.token"),console.log("üîÑ Demo session expired, removed from localStorage"))}}catch(i){console.warn("Could not restore demo session:",i),localStorage.removeItem("supabase.auth.token")}return Promise.resolve({data:{session:m}})},onAuthStateChange:i=>(console.warn("Supabase auth not available - using fallback"),e.push(i),setTimeout(()=>i(m?"SIGNED_IN":"SIGNED_OUT",m),100),{data:{subscription:{unsubscribe:()=>{e=e.filter(o=>o!==i)}}}}),signInWithPassword:({email:i,password:o})=>{console.warn("‚ö†Ô∏è Supabase signInWithPassword not available - using enhanced fallback demo auth");const u=100;return new Promise(d=>{setTimeout(()=>{if(!i||!o){d({error:new Error("E-Mail und Passwort sind erforderlich.")});return}if(!i.includes("@")){d({error:new Error("Bitte geben Sie eine g√ºltige E-Mail-Adresse ein.")});return}if(o.length<3){d({error:new Error("Passwort zu kurz (mindestens 3 Zeichen f√ºr Demo).")});return}m={user:{id:"demo-user-"+Date.now(),email:i,created_at:new Date().toISOString(),app_metadata:{provider:"demo",providers:["demo"]},user_metadata:{demo_mode:!0,connection_quality:n},aud:"authenticated",role:"authenticated"},access_token:"demo-token-"+Date.now(),refresh_token:"demo-refresh-"+Date.now(),expires_at:Date.now()/1e3+3600,expires_in:3600,token_type:"bearer"};try{localStorage.setItem("supabase.auth.token",JSON.stringify(m))}catch(a){console.warn("Could not persist demo session:",a)}e.forEach(a=>{setTimeout(()=>a("SIGNED_IN",m),50)}),d({data:{user:m.user,session:m},error:null})},u)})},signUp:({email:i,password:o})=>(console.warn("Supabase signUp not available - using fallback demo mode"),!i||!o?Promise.resolve({error:new Error("E-Mail und Passwort sind erforderlich.")}):o.length<6?Promise.resolve({error:new Error("Passwort muss mindestens 6 Zeichen haben.")}):Promise.resolve({data:{user:null,session:null},error:null})),signOut:()=>(console.warn("‚ö†Ô∏è Supabase signOut not available - using enhanced fallback"),new Promise(i=>{m=null;try{localStorage.removeItem("supabase.auth.token")}catch(o){console.warn("Could not clear stored session:",o)}e.forEach(o=>{setTimeout(()=>o("SIGNED_OUT",null),50)}),i({error:null})}))},from:i=>{let o={conditions:[]};const u=()=>{const a=r(i,o);return o={conditions:[]},Promise.resolve({data:a,error:null})},d={select:(a="*")=>d,eq:(a,c)=>(o.conditions.push({type:"eq",column:a,value:c}),d),neq:(a,c)=>(o.conditions.push({type:"neq",column:a,value:c}),d),gt:(a,c)=>(o.gt=[a,c],d),gte:(a,c)=>(o.gte=[a,c],d),lt:(a,c)=>(o.lt=[a,c],d),lte:(a,c)=>(o.lte=[a,c],d),like:(a,c)=>(o.like=[a,c],d),in:(a,c)=>(o.in=[a,c],d),order:(a,c={})=>(o.order=[a,c.ascending===!1?"desc":"asc"],d),range:(a,c)=>(o.range=[a,c],d),limit:a=>(o.limit=a,d),onConflict:a=>d,single:()=>{const a=r(i,o);o={};const c=a.length>0?a[0]:null;return Promise.resolve({data:c,error:null})},maybeSingle:()=>{const a=r(i,o);o={};const c=a.length>0?a[0]:null;return Promise.resolve({data:c,error:null})},then:(a,c)=>{u().then(a,c)},catch:a=>{u().catch(a)},finally:a=>{u().finally(a)},insert:a=>{console.warn("Supabase insert not available in demo mode - simulating success");const h={id:Math.max(...(t[i]||[]).map(g=>g.id||0))+1,...a,created_at:new Date().toISOString()};return t[i]&&t[i].push(h),{select:(g="*")=>(console.warn("Supabase insert().select() not available in demo mode - simulating success"),{single:()=>(console.warn("Supabase insert().select().single() not available in demo mode - simulating success"),Promise.resolve({data:h,error:null})),then:(f,y)=>{Promise.resolve({data:[h],error:null}).then(f,y)},catch:f=>{Promise.resolve({data:[h],error:null}).catch(f)},finally:f=>{Promise.resolve({data:[h],error:null}).finally(f)}}),single:()=>(console.warn("Supabase insert().single() not available in demo mode - simulating success"),Promise.resolve({data:h,error:null})),then:(g,f)=>{Promise.resolve({data:[h],error:null}).then(g,f)},catch:g=>{Promise.resolve({data:[h],error:null}).catch(g)},finally:g=>{Promise.resolve({data:[h],error:null}).finally(g)}}},update:a=>{console.warn("Supabase update not available in demo mode - simulating success");const c={},h={eq:(g,f)=>(console.warn(`Supabase update().eq() not available in demo mode - simulating success for ${g}=${f}`),c[g]=f,{eq:(y,S)=>(c[y]=S,h),then:(y,S)=>{const v=t[i]?t[i].filter(R=>Object.entries(c).every(([M,x])=>R[M]===x)):[];v.forEach(R=>{Object.assign(R,a)}),console.log(`Simulated update of ${v.length} item(s) in ${i} with conditions:`,c),y({data:v,error:null})}}),then:(g,f)=>{const y=r(i,o);o={},y.forEach(S=>{Object.assign(S,a)}),Promise.resolve({data:y,error:null}).then(g,f)},catch:g=>{const f=r(i,o);o={},f.forEach(y=>{Object.assign(y,a)}),Promise.resolve({data:f,error:null}).catch(g)},finally:g=>{const f=r(i,o);o={},f.forEach(y=>{Object.assign(y,a)}),Promise.resolve({data:f,error:null}).finally(g)}};return h},delete:()=>(console.warn("Supabase delete not available in demo mode - simulating success"),{eq:(a,c)=>{console.warn(`Supabase delete().eq() not available in demo mode - simulating success for ${a}=${c}`);const h=t[i]?t[i].filter(g=>g[a]===c):[];return t[i]&&h.length>0&&(t[i]=t[i].filter(g=>g[a]!==c),console.log(`Simulated deletion of ${h.length} item(s) from ${i} where ${a}=${c}`)),Promise.resolve({data:h,error:null})},then:(a,c)=>{const h=r(i,o);o={},t[i]&&h.length>0&&(t[i]=t[i].filter(g=>!h.some(f=>f.id===g.id))),a({data:h,error:null})}})};return d},channel:(i="default")=>{console.warn("‚ö†Ô∏è Supabase realtime not available - using enhanced fallback simulation");let o=[],u=!1;const d={on:(a,c,h)=>(console.log(`üì° Simulating real-time subscription for ${a} on ${(c==null?void 0:c.table)||"unknown table"}`),o.push({event:a,config:c,callback:h,id:Math.random().toString(36).substr(2,9)}),d),subscribe:a=>{if(console.log("üì° Simulating subscription activation..."),u=!0,s.set(i,{subscriptions:o,isActive:!0,created:Date.now()}),setTimeout(()=>{typeof a=="function"&&a("SUBSCRIBING")},50),setTimeout(()=>{typeof a=="function"&&(a("SUBSCRIBED"),console.log("‚úÖ Real-time subscription simulation active"))},100),o.some(c=>{var h;return(h=c.config)==null?void 0:h.table})){const c=setInterval(()=>{if(!u){clearInterval(c);return}Math.random()<.1&&o.forEach(h=>{var g;if((g=h.config)!=null&&g.table&&typeof h.callback=="function"){const f={eventType:["INSERT","UPDATE","DELETE"][Math.floor(Math.random()*3)],new:{id:Math.floor(Math.random()*1e3),updated_at:new Date().toISOString()},old:{},table:h.config.table,schema:"public",commit_timestamp:new Date().toISOString()};console.log("üì° Simulated real-time update:",f),h.callback(f)}})},5e3)}return d},unsubscribe:()=>(console.log("üì° Unsubscribing from real-time channel simulation"),u=!1,s.delete(i),Promise.resolve({error:null}))};return d},removeChannel:i=>(console.log("üì° Removing real-time channel simulation"),i&&typeof i.unsubscribe=="function"&&i.unsubscribe(),Promise.resolve({error:null}))}};var C,A;const k=typeof process<"u"&&((C=process==null?void 0:process.env)==null?void 0:C.VITE_SUPABASE_URL)||typeof process<"u"&&((A=process==null?void 0:process.env)==null?void 0:A.REACT_APP_SUPABASE_URL)||"https://buduldeczjwnjvsckqat.supabase.co";var q,D;const E=typeof process<"u"&&((q=process==null?void 0:process.env)==null?void 0:q.VITE_SUPABASE_ANON_KEY)||typeof process<"u"&&((D=process==null?void 0:process.env)==null?void 0:D.REACT_APP_SUPABASE_ANON_KEY)||"sb_publishable_wcOHaKNEW9rQ3anrRNlEpA_r1_wGda3";let p,b=!1;async function I(){const m=["https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js","https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.min.js","https://cdn.skypack.dev/@supabase/supabase-js@2"];for(const e of m)try{console.log(`üîÑ Attempting to load Supabase from: ${e}`);const s=document.createElement("script");s.src=e,s.crossOrigin="anonymous";const n=new Promise((t,r)=>{s.onload=()=>{const l=window.supabase||window.Supabase||window.supabaseJs;l&&l.createClient?(console.log(`‚úÖ Successfully loaded Supabase from: ${e}`),window.supabase=l,t(!0)):r(new Error("Supabase object not found after loading"))},s.onerror=()=>r(new Error(`Failed to load script from ${e}`)),setTimeout(()=>r(new Error(`Timeout loading from ${e}`)),5e3)});return document.head.appendChild(s),await n,s.remove(),!0}catch(s){console.warn(`‚ùå Failed to load from ${e}:`,s.message),document.querySelectorAll(`script[src="${e}"]`).forEach(t=>t.remove())}throw new Error("All CDN sources failed to load")}async function T(){try{const m=window.supabase||window.Supabase||window.supabaseJs;(!m||!m.createClient)&&await I();const e=window.supabase||window.Supabase||window.supabaseJs;if(!e||!e.createClient)throw new Error("Failed to load Supabase library from CDN");console.log("üîÑ Creating Supabase client with credentials..."),console.log("URL:",k),console.log("Key:",E.substring(0,20)+"..."),p=e.createClient(k,E,_);try{const{data:s,error:n}=await p.from("players").select("id").limit(1);n?console.warn("Database test query failed:",n.message):console.log("‚úÖ Database connection test successful")}catch(s){console.warn("Database connection test failed:",s.message)}console.log("‚úÖ Supabase client created successfully"),b=!1;return}catch(m){console.warn("‚ö†Ô∏è Failed to connect to Supabase, using fallback mode:",m.message),console.log("üìù Fallback mode provides demo data and simulated database operations"),b=!0,p=P()}}try{const m=window.supabase||window.Supabase||window.supabaseJs;if(m&&m.createClient)console.log("üîÑ Creating Supabase client..."),p=m.createClient(k,E,_),console.log("‚úÖ Supabase client created successfully"),b=!1;else throw new Error("Supabase library not available (CDN may be blocked)")}catch(m){console.warn("‚ö†Ô∏è Initial Supabase connection failed, using fallback:",m.message),console.log("üìù Will attempt CDN loading and retry automatically..."),b=!0,p=P()}typeof window<"u"&&(window.initializeSupabase=T,b&&(console.log("üîÑ Scheduling automatic retry of Supabase initialization..."),setTimeout(async()=>{try{console.log("üîÑ Retrying Supabase initialization..."),await T(),b||(console.log("‚úÖ Supabase initialization successful on retry"),window.dispatchEvent(new CustomEvent("supabase-reconnected",{detail:{timestamp:new Date().toISOString()}})))}catch{console.log("üîÑ Retry failed, staying in fallback mode")}},5e3)));class L{constructor(e){this.client=e,this.maxRetries=3,this.baseDelay=1e3,this.maxDelay=3e4,this.connectionStats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastResponseTime:0},this.requestQueue=[],this.isProcessingQueue=!1,this.maxConcurrentRequests=5,this.activeRequests=0}getStats(){return{...this.connectionStats,successRate:this.connectionStats.totalRequests>0?(this.connectionStats.successfulRequests/this.connectionStats.totalRequests*100).toFixed(2)+"%":"0%",activeRequests:this.activeRequests,queuedRequests:this.requestQueue.length}}resetStats(){this.connectionStats={totalRequests:0,successfulRequests:0,failedRequests:0,averageResponseTime:0,lastResponseTime:0}}async retryOperation(e,s=this.maxRetries,n="normal"){return new Promise((t,r)=>{const l={operation:e,maxRetries:s,priority:n,resolve:t,reject:r,timestamp:Date.now()};n==="high"?this.requestQueue.unshift(l):this.requestQueue.push(l),this.processQueue()})}async processQueue(){if(!(this.isProcessingQueue||this.activeRequests>=this.maxConcurrentRequests)){for(this.isProcessingQueue=!0;this.requestQueue.length>0&&this.activeRequests<this.maxConcurrentRequests;){const e=this.requestQueue.shift();this.executeRequest(e)}this.isProcessingQueue=!1}}async executeRequest(e){this.activeRequests++,this.connectionStats.totalRequests++;const s=performance.now();let n=null;try{for(let t=1;t<=e.maxRetries;t++)try{const r=await e.operation();if(r.error)throw r.error;const l=performance.now()-s;this.updateResponseTimeMetrics(l),this.connectionStats.successfulRequests++,e.resolve(r);return}catch(r){if(n=r,console.warn(`Database operation failed (attempt ${t}/${e.maxRetries}):`,r),this.isNonRetryableError(r)||t===e.maxRetries)break;const l=Math.min(this.baseDelay*Math.pow(2,t-1),this.maxDelay),i=Math.random()*.1*l,o=l+i;await new Promise(u=>setTimeout(u,o))}this.connectionStats.failedRequests++,e.reject(n)}catch(t){this.connectionStats.failedRequests++,e.reject(t)}finally{this.activeRequests--,setTimeout(()=>this.processQueue(),0)}}updateResponseTimeMetrics(e){this.connectionStats.lastResponseTime=e,this.connectionStats.averageResponseTime===0?this.connectionStats.averageResponseTime=e:this.connectionStats.averageResponseTime=this.connectionStats.averageResponseTime*.8+e*.2}isNonRetryableError(e){if(!e)return!1;const s=e.message?e.message.toLowerCase():"",n=e.code;return!!(s.includes("auth")||s.includes("unauthorized")||s.includes("forbidden")||n==="PGRST301"||n==="PGRST116"||n==="23505"||n==="23503"||e.status&&e.status>=400&&e.status<500)}async select(e,s="*",n={},t="normal"){if(!e)throw new Error("Table name is required");return this.retryOperation(async()=>{let r=this.client.from(e).select(s);return n.eq&&Object.entries(n.eq).forEach(([l,i])=>{i!=null&&(r=r.eq(l,i))}),n.neq&&Object.entries(n.neq).forEach(([l,i])=>{r=r.neq(l,i)}),n.gt&&Object.entries(n.gt).forEach(([l,i])=>{r=r.gt(l,i)}),n.gte&&Object.entries(n.gte).forEach(([l,i])=>{r=r.gte(l,i)}),n.lt&&Object.entries(n.lt).forEach(([l,i])=>{r=r.lt(l,i)}),n.lte&&Object.entries(n.lte).forEach(([l,i])=>{r=r.lte(l,i)}),n.like&&Object.entries(n.like).forEach(([l,i])=>{r=r.like(l,i)}),n.in&&Object.entries(n.in).forEach(([l,i])=>{Array.isArray(i)&&i.length>0&&(r=r.in(l,i))}),n.order&&(Array.isArray(n.order)?n.order.forEach(l=>{r=r.order(l.column,{ascending:l.ascending??!0})}):r=r.order(n.order.column,{ascending:n.order.ascending??!0})),n.limit&&(r=r.limit(Math.min(n.limit,1e3))),n.range&&(r=r.range(n.range.from,n.range.to)),await r},this.maxRetries,t)}async insert(e,s,n={},t="normal"){if(!e)throw new Error("Table name is required");if(!s)throw new Error("Data is required for insert");return this.retryOperation(async()=>{let r=this.client.from(e).insert(s);return n.returning!==!1&&(r=r.select()),n.onConflict&&(r=r.onConflict(n.onConflict)),await r},this.maxRetries,t)}async update(e,s,n={},t={},r="normal"){if(!e)throw new Error("Table name is required");if(!s)throw new Error("Data is required for update");if(Object.keys(n).length===0)throw new Error("At least one condition is required for update");return this.retryOperation(async()=>{let l=this.client.from(e).update(s);return Object.entries(n).forEach(([i,o])=>{o!=null&&(l=l.eq(i,o))}),t.returning!==!1&&(l=l.select()),await l},this.maxRetries,r)}async deleteRow(e,s={},n="normal"){if(!e)throw new Error("Table name is required");if(Object.keys(s).length===0)throw new Error("At least one condition is required for delete");return this.retryOperation(async()=>{let t=this.client.from(e).delete();return Object.entries(s).forEach(([r,l])=>{l!=null&&(t=t.eq(r,l))}),await t},this.maxRetries,n)}async upsert(e,s,n={},t="normal"){if(!e)throw new Error("Table name is required");if(!s)throw new Error("Data is required for upsert");return this.retryOperation(async()=>{let r=this.client.from(e).upsert(s);return n.onConflict&&(r=r.onConflict(n.onConflict)),n.returning!==!1&&(r=r.select()),await r},this.maxRetries,t)}async batchSelect(e){const s=e.map(t=>this.select(t.table,t.query,t.options,t.priority||"normal"));return(await Promise.allSettled(s)).map((t,r)=>({success:t.status==="fulfilled",data:t.status==="fulfilled"?t.value:null,error:t.status==="rejected"?t.reason:null,operation:e[r]}))}async healthCheck(){try{const e=await this.select("players","id",{limit:1},"high");return{healthy:!0,responseTime:this.connectionStats.lastResponseTime}}catch(e){return{healthy:!1,error:e.message}}}getClient(){return this.client}}const w=new L(p),{data:U}=p.auth.onAuthStateChange((m,e)=>{var n;const s=((n=e==null?void 0:e.user)==null?void 0:n.email)||"No user";console.log(`Auth state changed: ${m}`,s),m==="SIGNED_IN"?(console.log("‚úÖ User signed in successfully"),w.resetStats()):m==="SIGNED_OUT"?(console.log("üëã User signed out"),w.resetStats()):m==="TOKEN_REFRESHED"?e?console.log("üîÑ Auth token refreshed successfully"):(console.error("‚ùå Token refresh failed - user may need to re-authenticate"),window.dispatchEvent(new CustomEvent("supabase-session-expired",{detail:{timestamp:new Date().toISOString()}}))):m==="USER_UPDATED"?console.log("üë§ User profile updated"):m==="PASSWORD_RECOVERY"&&console.log("üîê Password recovery initiated"),window.dispatchEvent(new CustomEvent("auth-state-change",{detail:{event:m,session:e,user:e==null?void 0:e.user}}))});typeof window<"u"&&(window.supabase=p,window.supabaseDb=w,window.supabaseDebug={getStats:()=>w.getStats(),resetStats:()=>w.resetStats(),healthCheck:()=>w.healthCheck(),getQueueLength:()=>w.requestQueue.length,getActiveRequests:()=>w.activeRequests},(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1")&&setInterval(()=>{const m=w.getStats();m.totalRequests>0&&console.log("üìä Supabase Stats:",m)},6e4));class O{constructor(){this.slowQueryThreshold=2e3,this.slowQueries=[],this.maxSlowQueries=10}logSlowQuery(e,s,n,t){if(s>this.slowQueryThreshold){const r={operation:e,duration:Math.round(s),table:n,query:t||"N/A",timestamp:new Date().toISOString()};this.slowQueries.unshift(r),this.slowQueries.length>this.maxSlowQueries&&this.slowQueries.pop(),console.warn("üêå Slow database query detected:",r)}}getSlowQueries(){return this.slowQueries}clearSlowQueries(){this.slowQueries=[]}}const N=new O;typeof window<"u"&&(window.dbPerformanceMonitor=N);const K=4*60*1e3;class ${constructor(){this.isConnected=!0,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.maxReconnectDelay=3e4,this.healthCheckInterval=3e4,this.keepAliveTimer=null,this.healthCheckTimer=null,this.reconnectTimer=null,this.listeners=[],this.lastSuccessfulConnection=Date.now(),this.isPaused=!1,this.connectionType="unknown",this.lastError=null,this.connectionMetrics={totalConnections:0,successfulConnections:0,failedConnections:0,averageResponseTime:0,lastResponseTime:0},this.detectConnectionType(),this.startHealthCheck(),this.setupNetworkListeners(),this.startKeepAlive()}detectConnectionType(){b?(this.connectionType="fallback",console.log("üîÑ Connection type: Fallback mode (demo data)")):navigator.onLine?(this.connectionType="real",console.log("‚úÖ Connection type: Real database")):(this.connectionType="offline",this.isConnected=!1,console.log("üì¥ Connection type: Offline"))}addListener(e){this.listeners.push(e),setTimeout(()=>{e({connected:this.isConnected,connectionType:this.connectionType,metrics:this.connectionMetrics,lastError:this.lastError})},0)}removeListener(e){this.listeners=this.listeners.filter(s=>s!==e)}notifyListeners(e){const s={...e,connectionType:this.connectionType,metrics:this.connectionMetrics,timestamp:Date.now()};this.listeners.forEach(n=>{try{n(s)}catch(t){console.error("Error in connection listener:",t)}})}async checkConnection(){const e=performance.now();this.connectionMetrics.totalConnections++;try{if(b){const t=Math.random()*100+50;return this.updateMetrics(t,!0),this.isConnected||(console.log("üîÑ Demo mode - simulating connection restored"),this.isConnected=!0,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.lastSuccessfulConnection=Date.now(),this.lastError=null,this.notifyListeners({connected:!0,reconnected:!0,message:"Demo-Modus aktiv - Simulierte Daten verf√ºgbar"})),!0}if(!navigator.onLine)throw new Error("Keine Internetverbindung");const s=new AbortController,n=setTimeout(()=>s.abort(),1e4);try{const{data:t,error:r}=await p.from("players").select("id").limit(1).abortSignal(s.signal);if(clearTimeout(n),r)throw r;const l=performance.now()-e;return this.updateMetrics(l,!0),this.isConnected||(console.log("‚úÖ Database connection restored"),this.isConnected=!0,this.reconnectAttempts=0,this.reconnectDelay=1e3,this.lastSuccessfulConnection=Date.now(),this.lastError=null,this.connectionType="real",this.notifyListeners({connected:!0,reconnected:!0,message:"Datenbankverbindung wiederhergestellt"})),!0}catch(t){throw clearTimeout(n),t.name==="AbortError"?new Error("Verbindungstest-Timeout (> 10s)"):t}}catch(s){return this.updateMetrics(performance.now()-e,!1),this.lastError=s,console.warn("‚ùå Database connection check failed:",s.message),this.isConnected&&(console.log("üì¥ Database connection lost"),this.isConnected=!1,this.connectionType=s.message.includes("Internetverbindung")?"offline":"disconnected",this.notifyListeners({connected:!1,error:s,message:this.getErrorMessage(s)})),!1}}updateMetrics(e,s){this.connectionMetrics.lastResponseTime=e,s?(this.connectionMetrics.successfulConnections++,this.connectionMetrics.averageResponseTime===0?this.connectionMetrics.averageResponseTime=e:this.connectionMetrics.averageResponseTime=this.connectionMetrics.averageResponseTime*.7+e*.3):this.connectionMetrics.failedConnections++}getErrorMessage(e){if(!e)return"Unbekannter Fehler";const s=e.message.toLowerCase();return s.includes("internetverbindung")||s.includes("network")?"Keine Internetverbindung":s.includes("timeout")?"Verbindungs-Timeout - Server antwortet nicht":s.includes("auth")||s.includes("unauthorized")?"Authentifizierungsfehler - Bitte neu anmelden":s.includes("cdn")||s.includes("blocked")?"CDN blockiert - Fallback-Modus wird verwendet":`Datenbankfehler: ${e.message}`}async attemptReconnection(){if(this.isPaused){console.log("‚è∏Ô∏è Skipping reconnection attempt - monitor is paused");return}if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("‚ùå Max reconnection attempts reached"),this.notifyListeners({connected:!1,maxAttemptsReached:!0,nextRetry:Date.now()+this.maxReconnectDelay,message:"Maximale Wiederverbindungsversuche erreicht - Warte l√§nger..."}),this.reconnectTimer=setTimeout(()=>{this.isPaused||(console.log("üîÑ Resetting reconnection attempts after extended wait"),this.reconnectAttempts=0,this.reconnectDelay=1e3,this.attemptReconnection())},this.maxReconnectDelay);return}if(this.reconnectAttempts++,console.log(`üîÑ Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),!navigator.onLine){console.log("üì¥ Network is offline, waiting for network recovery..."),this.notifyListeners({connected:!1,networkOffline:!0,reconnecting:!1,message:"Warte auf Netzwerkverbindung..."}),this.reconnectAttempts--,this.reconnectTimer=setTimeout(()=>{this.isPaused||this.attemptReconnection()},5e3);return}if(!await this.checkConnection()&&!this.isPaused){const s=Math.min(this.reconnectDelay*2,this.maxReconnectDelay),n=Math.random()*.3*s;this.reconnectDelay=s+n,this.notifyListeners({connected:!1,reconnecting:!0,attempt:this.reconnectAttempts,nextRetry:Date.now()+this.reconnectDelay,message:`Wiederverbindung... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`}),this.reconnectTimer=setTimeout(()=>{this.isPaused||this.attemptReconnection()},this.reconnectDelay)}}startHealthCheck(){this.healthCheckTimer&&clearInterval(this.healthCheckTimer),this.healthCheckTimer=setInterval(async()=>{if(this.isPaused||!this.isConnected)return;await this.checkConnection()||this.attemptReconnection()},this.healthCheckInterval)}startKeepAlive(){this.keepAliveTimer&&clearInterval(this.keepAliveTimer),this.keepAliveTimer=setInterval(async()=>{if(!this.isPaused&&this.isConnected)try{await p.from("players").select("id").limit(1)}catch(e){console.warn("KeepAlive failed:",e.message)}},K)}stopKeepAlive(){this.keepAliveTimer&&(clearInterval(this.keepAliveTimer),this.keepAliveTimer=null)}pauseHealthChecks(){console.log("Pausing connection health checks"),this.isPaused=!0,this.healthCheckTimer&&(clearInterval(this.healthCheckTimer),this.healthCheckTimer=null),this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopKeepAlive()}resumeHealthChecks(){console.log("Resuming connection health checks"),this.isPaused=!1,this.startHealthCheck(),this.startKeepAlive(),this.isConnected||this.checkConnection()}setupNetworkListeners(){window.addEventListener("online",()=>{console.log("üåê Network connection restored"),this.connectionType=b?"fallback":"real",this.isConnected||(this.reconnectAttempts=0,this.reconnectDelay=1e3,this.checkConnection())}),window.addEventListener("offline",()=>{console.log("üì¥ Network connection lost"),this.isConnected=!1,this.connectionType="offline",this.lastError=new Error("Keine Internetverbindung"),this.notifyListeners({connected:!1,networkOffline:!0,message:"Netzwerkverbindung verloren"})}),window.addEventListener("supabase-session-expired",()=>{console.log("üîê Supabase session expired"),this.isConnected=!1,this.connectionType="expired",this.lastError=new Error("Session abgelaufen"),this.notifyListeners({connected:!1,sessionExpired:!0,message:"Session abgelaufen - Bitte neu anmelden"})}),document.addEventListener("visibilitychange",()=>{document.hidden?(console.log("üì± App hidden - reducing health check frequency"),this.healthCheckInterval=6e4):(console.log("üì± App visible - resuming normal health checks"),this.healthCheckInterval=3e4,this.startHealthCheck(),this.isPaused||this.checkConnection())})}getStatus(){return{connected:this.isConnected,connectionType:this.connectionType,reconnectAttempts:this.reconnectAttempts,maxReconnectAttempts:this.maxReconnectAttempts,lastSuccessfulConnection:this.lastSuccessfulConnection,timeSinceLastConnection:Date.now()-this.lastSuccessfulConnection,isPaused:this.isPaused,lastError:this.lastError,metrics:{...this.connectionMetrics,successRate:this.connectionMetrics.totalConnections>0?Math.round(this.connectionMetrics.successfulConnections/this.connectionMetrics.totalConnections*100):0},networkOnline:navigator.onLine,usingFallback:b}}getDiagnostics(){return{...this.getStatus(),timestamp:new Date().toISOString(),userAgent:navigator.userAgent,connectionSpeed:this.estimateConnectionSpeed(),recommendations:this.getRecommendations()}}estimateConnectionSpeed(){if(this.connectionMetrics.averageResponseTime===0)return"unknown";const e=this.connectionMetrics.averageResponseTime;return e<100?"fast":e<500?"medium":e<1e3?"slow":"very-slow"}getRecommendations(){const e=[];return this.isConnected||(navigator.onLine?this.connectionType==="fallback"?(e.push("CDN ist blockiert - Demo-Modus wird verwendet"),e.push("Konfigurieren Sie Supabase-Credentials f√ºr echte Datenbankverbindung")):this.connectionType==="expired"?e.push("Melden Sie sich erneut an"):e.push("Server tempor√§r nicht erreichbar - Wiederverbindung l√§uft..."):e.push("√úberpr√ºfen Sie Ihre Internetverbindung")),this.connectionMetrics.averageResponseTime>2e3&&e.push("Langsame Verbindung erkannt - √úberpr√ºfen Sie Ihre Netzwerkgeschwindigkeit"),this.connectionMetrics.failedConnections>5&&e.push("H√§ufige Verbindungsfehler - √úberpr√ºfen Sie Ihre Netzwerkstabilit√§t"),e}destroy(){this.healthCheckTimer&&clearInterval(this.healthCheckTimer),this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.keepAliveTimer&&clearInterval(this.keepAliveTimer),this.listeners=[]}}const B=new $;function j(){return b||B.isConnected}class Q{constructor(){this.cache=new Map,this.pendingRequests=new Map,this.cacheExpiry=new Map,this.defaultCacheTTL=3e4,this.batchQueue=[],this.batchTimer=null,this.batchDelay=100,this.validationRules=this.initValidationRules()}initValidationRules(){return{players:{name:{required:!0,type:"string",minLength:1},team:{required:!0,type:"string"},value:{required:!1,type:"number",min:0},goals:{required:!1,type:"number",min:0},position:{required:!1,type:"string"}},matches:{date:{required:!0,type:"string"},teama:{required:!0,type:"string"},teamb:{required:!0,type:"string"},goalsa:{required:!0,type:"number",min:0},goalsb:{required:!0,type:"number",min:0},goalslista:{required:!1},goalslistb:{required:!1},yellowa:{required:!1,type:"number",min:0},reda:{required:!1,type:"number",min:0},yellowb:{required:!1,type:"number",min:0},redb:{required:!1,type:"number",min:0},manofthematch:{required:!1,type:"string"},prizeaek:{required:!1,type:"number"},prizereal:{required:!1,type:"number"}},bans:{player_id:{required:!1,type:"number"},team:{required:!0,type:"string"},type:{required:!0,type:"string"},totalgames:{required:!0,type:"number",min:0},matchesserved:{required:!1,type:"number",min:0},reason:{required:!1,type:"string"}},transactions:{date:{required:!0,type:"string"},type:{required:!0,type:"string"},team:{required:!0,type:"string"},amount:{required:!0,type:"number"},info:{required:!1,type:"string"},match_id:{required:!1,type:"number"}},finances:{team:{required:!0,type:"string"},balance:{required:!1,type:"number"},debt:{required:!1,type:"number"}},spieler_des_spiels:{name:{required:!0,type:"string",minLength:1},team:{required:!0,type:"string"},count:{required:!1,type:"number",min:0}},managers:{name:{required:!0,type:"string",minLength:1},gewicht:{required:!0,type:"number",min:40,max:200}}}}validateData(e,s){const n=this.validationRules[e];if(!n)return{valid:!0};const t=[];for(const[r,l]of Object.entries(n)){const i=s[r];if(l.required&&(i==null||i==="")){t.push(`${r} ist erforderlich`);continue}!l.required&&(i==null||i==="")||(l.type==="string"&&typeof i!="string"?t.push(`${r} muss ein Text sein`):l.type==="number"&&(typeof i!="number"||isNaN(i))&&t.push(`${r} muss eine Zahl sein`),l.type==="string"&&typeof i=="string"&&(l.minLength&&i.length<l.minLength&&t.push(`${r} muss mindestens ${l.minLength} Zeichen haben`),l.maxLength&&i.length>l.maxLength&&t.push(`${r} darf maximal ${l.maxLength} Zeichen haben`)),l.type==="number"&&typeof i=="number"&&(l.min!==void 0&&i<l.min&&t.push(`${r} muss mindestens ${l.min} sein`),l.max!==void 0&&i>l.max&&t.push(`${r} darf maximal ${l.max} sein`)),l.enum&&!l.enum.includes(i)&&t.push(`${r} muss einer der folgenden Werte sein: ${l.enum.join(", ")}`))}return{valid:t.length===0,errors:t}}sanitizeData(e){const s={};for(const[n,t]of Object.entries(e))typeof t=="string"?s[n]=t.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""):s[n]=t;return s}getCacheKey(e,s={}){return`${e}:${JSON.stringify(s)}`}isCacheValid(e){const s=this.cacheExpiry.get(e);return s&&Date.now()<s}setCache(e,s,n=this.defaultCacheTTL){this.cache.set(e,s),this.cacheExpiry.set(e,Date.now()+n)}getCache(e){return this.isCacheValid(e)?this.cache.get(e):(this.cache.delete(e),this.cacheExpiry.delete(e),null)}invalidateCache(e=null){if(e)for(const s of this.cache.keys())s.includes(e)&&(this.cache.delete(s),this.cacheExpiry.delete(s));else this.cache.clear(),this.cacheExpiry.clear()}async executeWithRetry(e,s=3){if(!j())throw new Error("Keine Datenbankverbindung verf√ºgbar. Bitte sp√§ter versuchen.");let n;for(let t=1;t<=s;t++)try{const r=await e();if(r&&r.error)throw r.error;return r}catch(r){if(n=r,console.warn(`Database operation failed (attempt ${t}/${s}):`,r),t===s||this.isNonRetryableError(r))break;const l=Math.min(1e3*Math.pow(2,t-1),5e3);await new Promise(i=>setTimeout(i,l))}throw n}isNonRetryableError(e){if(!e)return!1;const s=e.message||"";return s.includes("auth")||s.includes("permission")||s.includes("constraint")||e.code==="PGRST301"||e.code==="PGRST116"}async batchedSelect(e){return(await Promise.allSettled(e.map(n=>this.select(n.table,n.query,n.options)))).map((n,t)=>({key:e[t].key,success:n.status==="fulfilled",data:n.status==="fulfilled"?n.value:null,error:n.status==="rejected"?n.reason:null}))}async select(e,s="*",n={}){const t=this.getCacheKey(e,{query:s,options:n}),r=this.getCache(t);if(r!==null)return{data:r,fromCache:!0};if(this.pendingRequests.has(t))return this.pendingRequests.get(t);const l=this.executeWithRetry(async()=>{let i=p.from(e).select(s);return n.eq&&Object.entries(n.eq).forEach(([o,u])=>{i=i.eq(o,u)}),n.order&&(i=i.order(n.order.column,{ascending:n.order.ascending??!0})),n.limit&&(i=i.limit(n.limit)),n.range&&(i=i.range(n.range.from,n.range.to)),await i}).then(i=>(this.pendingRequests.delete(t),i&&i.data&&this.setCache(t,i.data),i)).catch(i=>{throw this.pendingRequests.delete(t),i});return this.pendingRequests.set(t,l),l}async insert(e,s){const n=this.sanitizeData(s),t=this.validateData(e,n);if(!t.valid)throw new Error(`Validierungsfehler: ${t.errors.join(", ")}`);const r=await this.executeWithRetry(async()=>await p.from(e).insert([n]).select());return this.invalidateCache(e),r}async update(e,s,n){const t=this.sanitizeData(s),r=this.validateData(e,t);if(!r.valid)throw new Error(`Validierungsfehler: ${r.errors.join(", ")}`);const l=await this.executeWithRetry(async()=>await p.from(e).update(t).eq("id",n).select());return this.invalidateCache(e),l}async delete(e,s){if(!s)throw new Error("ID ist erforderlich zum L√∂schen");const n=await this.executeWithRetry(async()=>await p.from(e).delete().eq("id",s));return this.invalidateCache(e),n}async upsert(e,s){const n=this.sanitizeData(s),t=this.validateData(e,n);if(!t.valid)throw new Error(`Validierungsfehler: ${t.errors.join(", ")}`);const r=await this.executeWithRetry(async()=>await p.from(e).upsert(n).select());return this.invalidateCache(e),r}async getPlayersByTeam(e){return this.select("players","*",{eq:{team:e}})}async getAllPlayers(){return this.select("players","*")}async getAllMatches(){return this.select("matches","*",{order:{column:"id",ascending:!1}})}async getBans(){return this.select("bans","*")}async getFinances(){return this.select("finances","*")}async getTransactions(){return this.select("transactions","*",{order:{column:"id",ascending:!1}})}async getSpielerDesSpiels(){return this.select("spieler_des_spiels","*")}async getManagers(){return this.select("managers","*",{order:{column:"id",ascending:!0}})}async loadAllAppData(){const e=[{key:"matches",table:"matches",query:"*",options:{order:{column:"id",ascending:!1}}},{key:"players",table:"players",query:"*",options:{}},{key:"bans",table:"bans",query:"*",options:{}},{key:"finances",table:"finances",query:"*",options:{}},{key:"transactions",table:"transactions",query:"*",options:{order:{column:"id",ascending:!1}}},{key:"spieler_des_spiels",table:"spieler_des_spiels",query:"*",options:{}},{key:"managers",table:"managers",query:"*",options:{order:{column:"id",ascending:!0}}}],s=await this.batchedSelect(e),n={};for(const t of s)t.success?n[t.key]=t.data.data||[]:(console.error(`Failed to load ${t.key}:`,t.error),n[t.key]=[]);return n.matches&&(n.matches=n.matches.map(t=>{try{typeof t.goalslista=="string"&&(t.goalslista=JSON.parse(t.goalslista)),typeof t.goalslistb=="string"&&(t.goalslistb=JSON.parse(t.goalslistb)),Array.isArray(t.goalslista)||(t.goalslista=[]),Array.isArray(t.goalslistb)||(t.goalslistb=[])}catch(r){console.warn("Error parsing goals for match",t.id,r),t.goalslista=[],t.goalslistb=[]}return t})),n}async healthCheck(){try{return await this.select("players","id",{limit:1}),!0}catch(e){return console.error("Health check failed:",e),!1}}}const z=new Q;export{z as d,p as s};
